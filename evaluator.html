<!DOCTYPE html>
<html>
  <head>
    <title> Run Javascript!, Run! </title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.18.2/codemirror.css">
    <script src="epicsound.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.18.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.18.2/mode/javascript/javascript.min.js"></script>
  </head>
  <body style="background:lightgray">

    <h1>Write your code in the box, Think outside of the box!</h1>

    <button onclick="go();"> Go </button>
    <button onclick="cleanup();"> Clear </button>
    <textarea class="left" id="source" style="display: table"> "write here" </textarea>
    <div id="output" class="right"></div>

    <script>
      var editor = CodeMirror.fromTextArea(document.getElementById("source"), {
        lineNumbers: true,
        matchBrackets: true,
        continueComments: "Enter",
        extraKeys: {"Ctrl-Q": "toggleComment"}
      });

    function addTag(text, element, boom) {
      var tag = document.createElement("PRE");
      if (boom) {tag.setAttribute("style", "color:red");}
      tag.textContent = text;
      element.appendChild(tag);
    }

    function go(){
    var output = document.getElementById("output");
    var code = editor.getValue();

    try{
    var evaluation = eval(code);
    addTag( code + " -->\n\t" + evaluation, output);
    } catch (err) {
      if(err.lineNumber != undefined){
            addTag(code + " failed with:\n\t" + err.message +"\n" + "Line: " + err.lineNumber + " Col: " + err.columnNumber, output, true);
      	    editor.doc.setCursor(err.lineNumber, err.columnNumber);
	    editor.focus();
	    } else {
	    addTag(code + " failed with:\n\t" + err.message +"\n" + "Run it on Firefox to know the location of the error.", output, true);
	    }
      epicBeep();
    }};

    function cleanup() {
    var output = document.getElementById("output");
    output.innerText = "";
    };
  </script>



</body>
</html>
